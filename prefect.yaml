name: land_pipeline
prefect-version: 3.4.24

pull:
  - prefect.deployments.steps.git_clone:
      id: clone
      repository: "https://github.com/KeoshaYoung/land_pipeline.git"
      branch: "main"
  - prefect.deployments.steps.set_working_directory:
      directory: "{{ clone.directory }}"

deployments:
  # Lead ingestion flow
  - name: nightly_ingest
    entrypoint: flow_leads.py:lead_ingest
    tags: [land, biz, prod]
    work_pool:
      name: serverless-1
      job_variables:
        image: "prefecthq/prefect-client:3-python3.11"
        pip_packages: ["prefect>=3.4", "requests"]
    schedules:
      - cron: "0 2 * * *"
        timezone: "America/New_York"
        day_or: true

  # Nightly Airtable backup to Google Drive (via Make)
  - name: nightly_backup
    entrypoint: nightly_backup.py:nightly_backup
    tags: [backup, prod]
    work_pool:
      name: serverless-1
      job_variables:
        image: "prefecthq/prefect-client:3-python3.11"
        pip_packages: ["prefect>=3.4", "httpx"]
    schedules:
      - cron: "5 2 * * *"
        timezone: "America/New_York"
        day_or: true
    parameters: {}

  # PandaDoc document generation flows (manually triggered)
  - name: pandadoc-offer
    entrypoint: flows/pandadoc_triggers.py:create_offer_letter
    work_pool:
      name: serverless-1
      job_variables:
        image: "prefecthq/prefect-client:3-python3.11"
        pip_packages: ["prefect>=3.4", "httpx"]
    schedules: []
    parameters: {}
    description: "Manually triggered - creates PandaDoc Offer Letter"

  - name: pandadoc-psa
    entrypoint: flows/pandadoc_triggers.py:create_psa
    work_pool:
      name: serverless-1
      job_variables:
        image: "prefecthq/prefect-client:3-python3.11"
        pip_packages: ["prefect>=3.4", "httpx"]
    schedules: []
    parameters: {}
    description: "Manually triggered - creates PandaDoc PSA"
